ant.properties['sdk.dir']="$System.env.ANDROID_HOME"
ant.properties['target']='android-19'
ant.properties['out.filename']=project.name+'_tests.jar'
ant.properties['source.dir']=project.path+'uiTests' // Or wherever your tests are
ant.importBuild "$System.env.ANDROID_HOME"+'/tools/ant/uibuild.xml'

task uiBuild() << {
	ant.project.executeTarget('build')
}

task uiInstall(dependsOn: ['uiBuild']) << {
	ant.project.executeTarget('install')
}

task uiRun(dependsOn: ['uiInstall']) << {
    Process proc = ["adb", "shell", "uiautomator", "runtest", project.name+"_tests.jar", "-e because broken"].execute()
    proc.consumeProcessErrorStream(System.err)
    proc.consumeProcessOutputStream(System.out)
    if (proc.waitFor() != 0) {
        throw new RuntimeException('exec failed')
    } 
}
